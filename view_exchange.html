<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <title>Exchange {{ exchange_id }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            "50":"#f0faff","100":"#e0f2fe","200":"#bae6fd","300":"#7dd3fc",
                            "400":"#38bdf8","500":"#0ea5e9","600":"#0284c7","700":"#0369a1",
                            "800":"#075985","900":"#0c4a6e","950":"#082f49"
                        },
                        blueEye: {
                            "50": "#f0f9ff",
                            "100": "#e0f7ff",
                            "200": "#c0e8ff",
                            "300": "#99d5ff",
                            "400": "#5aafff",
                            "500": "#3b82f6",
                            "600": "#1d4ed8",
                            "700": "#1e40af",
                            "800": "#1e3a8a",
                            "900": "#172554"
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.5s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .gradient-bg {
            background: linear-gradient(-45deg, #7038ff, #00a3ff, #3b82f6, #5f8fff);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        .light-gradient-bg {
            background: linear-gradient(-45deg, #e0f2fe, #93c5fd, #bfdbfe, #60a5fa);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        .blue-gradient-bg {
            background: linear-gradient(-45deg, #1e3a8a, #1d4ed8, #3b82f6, #60a5fa);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Temas */
        .theme-dark {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --accent-color: #3b82f6;
        }

        .theme-light {
            --bg-primary: #f8fafc;
            --bg-secondary: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #334155;
            --accent-color: #3b82f6;
        }

        .theme-blue-eye {
            --bg-primary: #15263a;
            --bg-secondary: #1a365d;
            --text-primary: #e0f2fe;
            --text-secondary: #bae6fd;
            --accent-color: #60a5fa;
        }
    </style>
</head>

<body class="bg-slate-900 text-gray-100 font-sans transition-colors duration-300" id="app-body">
    <div class="min-h-full flex flex-col">
        <!-- Barra de navegaci√≥n mejorada -->
        <nav class="sticky top-0 z-50 backdrop-blur-md bg-slate-900/80 border-b border-slate-800 shadow-md transition-colors">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                <div class="flex h-16 items-center justify-between">
                    <div class="flex items-center">
                        <div class="text-2xl font-bold bg-clip-text text-transparent gradient-bg">BOTXI</div>
                        <span class="bg-blue-600 text-xs px-2 py-1 rounded-full animate-pulse-slow ml-2">Beta</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!-- Selector de idioma -->
                        <div class="relative" id="language-selector">
                            <button class="flex items-center space-x-1 text-sm bg-slate-800 hover:bg-slate-700 rounded-lg px-3 py-2 transition-colors" id="language-button">
                                <span class="language-text">üá™üá∏ Espa√±ol</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>
                            <div class="absolute right-0 mt-2 bg-slate-800 rounded-lg shadow-lg p-2 hidden w-36 z-10" id="language-dropdown">
                                <button data-lang="es" class="language-option block w-full text-left px-3 py-2 rounded hover:bg-slate-700 text-sm">üá™üá∏ Espa√±ol</button>
                                <button data-lang="en" class="language-option block w-full text-left px-3 py-2 rounded hover:bg-slate-700 text-sm">üá∫üá∏ English</button>
                                <button data-lang="pt" class="language-option block w-full text-left px-3 py-2 rounded hover:bg-slate-700 text-sm">üáßüá∑ Portugu√™s</button>
                            </div>
                        </div>

                        <!-- Selector de tema -->
                        <div class="relative" id="theme-selector">
                            <button class="flex items-center space-x-1 text-sm bg-slate-800 hover:bg-slate-700 rounded-lg px-3 py-2 transition-colors" id="theme-button">
                                <span class="theme-text">üåë Oscuro</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>
                            <div class="absolute right-0 mt-2 bg-slate-800 rounded-lg shadow-lg p-2 hidden w-36 z-10" id="theme-dropdown">
                                <button data-theme="dark" class="theme-option block w-full text-left px-3 py-2 rounded hover:bg-slate-700 text-sm">üåë <span class="theme-name">Oscuro</span></button>
                                <button data-theme="light" class="theme-option block w-full text-left px-3 py-2 rounded hover:bg-slate-700 text-sm">‚òÄÔ∏è <span class="theme-name">Claro</span></button>
                                <button data-theme="blue-eye" class="theme-option block w-full text-left px-3 py-2 rounded hover:bg-slate-700 text-sm">üëÅÔ∏è <span class="theme-name">Azul</span></button>
                            </div>
                        </div>

                        <a href="{{ url_for('index') }}" class="text-white hover:bg-white/20 px-3 py-2 rounded-md text-sm font-medium transition-colors">
                            <span class="i18n" data-key="backToHome">Volver al Inicio</span>
                        </a>
                    </div>
                </div>
            </div>
        </nav>

        <header class="bg-gray-800 shadow">
            <div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8">
                <h1 class="text-3xl font-bold tracking-tight text-white bg-clip-text text-transparent gradient-bg">
                    <span class="i18n" data-key="exchange">Exchange</span>: {{ exchange_id }}
                </h1>
            </div>
        </header>

        <main class="flex-grow p-4">
            <div class="mx-auto max-w-7xl">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        <div class="mb-4 space-y-2">
                        {% for category, message in messages %}
                            <li class="p-4 mb-4 text-sm rounded-xl
                                {% if category == 'error' %}
                                    bg-red-900/30 text-red-200 border border-red-700
                                {% else %}
                                    bg-green-900/30 text-green-200 border border-green-700
                                {% endif %}
                                animate-fade-in">
                                {{ message }}
                            </li>
                        {% endfor %}
                        </div>
                    {% endif %}
                {% endwith %}

                <div class="flex flex-wrap justify-center gap-4 mb-8">
                    <a href="{{ url_for('add_token_route', exchange_id=exchange_id) }}"
                       class="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold py-2 px-4 rounded-xl shadow-lg shadow-green-600/20 transition-all duration-300 ease-in-out transform hover:scale-105 flex items-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                        </svg>
                        <span class="i18n" data-key="addToken">Agregar Token</span>
                    </a>
                    <a href="{{ url_for('exchange_pnl', exchange_id=exchange_id) }}"
                       class="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold py-2 px-4 rounded-xl shadow-lg shadow-blue-600/20 transition-all duration-300 ease-in-out transform hover:scale-105 flex items-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M3 3a1 1 0 000 2h10a1 1 0 100-2H3zm0 4a1 1 0 000 2h6a1 1 0 100-2H3zm0 4a1 1 0 100 2h12a1 1 0 100-2H3z" clip-rule="evenodd" />
                        </svg>
                        <span class="i18n" data-key="detailedPnL">Ver PnL Detallado</span>
                    </a>
                </div>

                <div x-data="{ activeTab: 'tokens' }" class="mb-8">
                    <div class="flex space-x-2 mb-4 overflow-x-auto scrollbar-hide">
                        <button @click="activeTab = 'tokens'"
                                :class="{ 'bg-blue-600': activeTab === 'tokens', 'bg-gray-600': activeTab !== 'tokens' }"
                                class="px-4 py-2 rounded-xl text-white font-medium transition-colors flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z" />
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd" />
                            </svg>
                            <span class="i18n" data-key="tokens">Tokens</span>
                        </button>
                        <button @click="activeTab = 'orders'"
                                :class="{ 'bg-blue-600': activeTab === 'orders', 'bg-gray-600': activeTab !== 'orders' }"
                                class="px-4 py-2 rounded-xl text-white font-medium transition-colors flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 2a4 4 0 00-4 4v1H5a1 1 0 00-.994.89l-1 9A1 1 0 004 18h12a1 1 0 00.994-1.11l-1-9A1 1 0 0015 7h-1V6a4 4 0 00-4-4zm2 5V6a2 2 0 10-4 0v1h4zm-6 3a1 1 0 112 0 1 1 0 01-2 0zm7-1a1 1 0 100 2 1 1 0 000-2z" clip-rule="evenodd" />
                            </svg>
                            <span class="i18n" data-key="openOrders">√ìrdenes Abiertas</span>
                        </button>
                    </div>

                    <!-- Secci√≥n de Tokens -->
                    <div x-show="activeTab === 'tokens'" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3 animate-fade-in">
                        {% for token in tokens %}
                        <div class="bg-slate-800/60 backdrop-blur-sm rounded-xl shadow-lg p-4 border border-slate-700 hover:border-slate-600 transition-colors animate-slide-up"
                             style="animation-delay: {{ loop.index0 * 100 }}ms;">
                            <div class="flex justify-between items-start mb-4">
                                <h3 class="text-lg font-semibold">{{ token.symbol }}</h3>
                                <span class="px-2 py-1 text-xs rounded-full {% if token.get('active_exchanges', {}).get(exchange_id, True) %}bg-green-500/20 text-green-400 border border-green-700/30{% else %}bg-red-500/20 text-red-400 border border-red-700/30{% endif %}">
                                    <span class="i18n" data-key="{% if token.get('active_exchanges', {}).get(exchange_id, True) %}active{% else %}inactive{% endif %}">
                                        {{ 'Activo' if token.get('active_exchanges', {}).get(exchange_id, True) else 'Inactivo' }}
                                    </span>
                                </span>
                            </div>
                            <div class="space-y-2 mb-4">
                                <!-- Estrategia -->
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-400 text-sm i18n" data-key="strategy">Estrategia:</span>
                                    <span class="bg-blue-900/30 text-blue-400 border border-blue-700/30 px-2 py-1 rounded-lg text-xs">
                                        {% set estrategia = {
                                            'strategy1': 'Grilla ML',
                                            'strategy2': 'Reinversi√≥n',
                                            'strategy3': 'ATAM ML',
                                            'strategy4': 'Breakout',
                                            'strategy5': 'Sniper',
                                            'compound': 'Compound',
                                            'infinity': 'Infinity'
                                        } %}
                                        {{ estrategia.get(token.strategy, 'Grilla ML') }}
                                    </span>
                                </div>

                                <!-- Detalles seg√∫n estrategia -->
                                {% if token.strategy == 'compound' %}
                                    <div class="grid grid-cols-2 gap-2 mt-3">
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="spread">Spread:</p>
                                            <p class="text-sm font-medium">{{ token.spread if token.spread is not none else 'N/A' }}</p>
                                        </div>
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="takeProfit">Take Profit:</p>
                                            <p class="text-sm font-medium">{{ token.take_profit if token.take_profit is not none else 'N/A' }}</p>
                                        </div>
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="maxOrders">M√°x. √ìrdenes:</p>
                                            <p class="text-sm font-medium">{{ token.max_orders if token.max_orders is not none else 'N/A' }}</p>
                                        </div>
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="expiration">Expiraci√≥n:</p>
                                            <p class="text-sm font-medium">{{ token.order_expiration if token.order_expiration is not none else 'N/A' }}</p>
                                        </div>
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="initialCapital">Capital Inicial:</p>
                                            <p class="text-sm font-medium">{{ token.initial_capital if token.initial_capital is not none else 'N/A' }}</p>
                                        </div>
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="reinvestmentPct">% Reinversi√≥n:</p>
                                            <p class="text-sm font-medium">{{ token.reinvestment_percentage if token.reinvestment_percentage is not none else 'N/A' }}%</p>
                                        </div>
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="maxReinvestment">M√°x. Reinversi√≥n:</p>
                                            <p class="text-sm font-medium">{{ token.max_reinvestment_pct if token.max_reinvestment_pct is not none else 'N/A' }}%</p>
                                        </div>
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="reservePct">% Reserva:</p>
                                            <p class="text-sm font-medium">{{ token.reserve_percentage if token.reserve_percentage is not none else 'N/A' }}%</p>
                                        </div>
                                    </div>
                                    <div class="bg-slate-700/30 rounded-lg p-2 mt-2">
                                        <p class="text-gray-400 text-xs mb-1 i18n" data-key="dailyLossMax">P√©rdida Diaria M√°x:</p>
                                        <p class="text-sm font-medium">{{ token.daily_loss_max if token.daily_loss_max is not none else 'N/A' }}</p>
                                    </div>
                                {% elif token.strategy == 'infinity' %}
                                    <div class="grid grid-cols-2 gap-2 mt-3">
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="totalBalanceUsdt">Capital Total (USDT):</p>
                                            <p class="text-sm font-medium">{{ token.total_balance_usdt if token.total_balance_usdt is not none else 'N/A' }}</p>
                                        </div>
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="gridInterval">Intervalo de Grilla:</p>
                                            <p class="text-sm font-medium">{{ token.grid_interval if token.grid_interval is not none else 'N/A' }}</p>
                                        </div>
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="minPrice">Precio M√≠nimo:</p>
                                            <p class="text-sm font-medium">{{ token.min_price if token.min_price is not none else 'N/A' }}</p>
                                        </div>
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="checkInterval">Intervalo de Revisi√≥n (s):</p>
                                            <p class="text-sm font-medium">{{ token.check_interval if token.check_interval is not none else 'N/A' }}</p>
                                        </div>
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="commission">Comisi√≥n:</p>
                                            <p class="text-sm font-medium">{{ token.commission if token.commission is not none else 'N/A' }}</p>
                                        </div>
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="reinvestmentPct">% Reinversi√≥n:</p>
                                            <p class="text-sm font-medium">{{ token.reinvestment_percentage if token.reinvestment_percentage is not none else 'N/A' }}%</p>
                                        </div>
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="maxReinvestment">M√°x. Reinversi√≥n:</p>
                                            <p class="text-sm font-medium">{{ token.max_reinvestment_pct if token.max_reinvestment_pct is not none else 'N/A' }}%</p>
                                        </div>
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="reservePct">% Reserva:</p>
                                            <p class="text-sm font-medium">{{ token.reserve_percentage if token.reserve_percentage is not none else 'N/A' }}%</p>
                                        </div>
                                    </div>
                                {% else %}
                                    <div class="grid grid-cols-2 gap-2 mt-3">
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="spread">Spread:</p>
                                            <p class="text-sm font-medium">{{ token.spread if token.spread is not none else 'N/A' }}</p>
                                        </div>
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="takeProfit">Take Profit:</p>
                                            <p class="text-sm font-medium">{{ token.take_profit if token.take_profit is not none else 'N/A' }}</p>
                                        </div>
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="tradeAmount">Cantidad de Trade:</p>
                                            <p class="text-sm font-medium">{{ token.trade_amount }}</p>
                                        </div>
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="maxOrders">M√°x √ìrdenes:</p>
                                            <p class="text-sm font-medium">{{ token.max_orders if token.max_orders is not none else 'N/A' }}</p>
                                        </div>
                                        <div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="maxSellOrders">M√°x √ìrdenes de Venta:</p>
                                            <p class="text-sm font-medium">{{ token.max_sell_orders if token.max_sell_orders is not none else 'N/A' }}</p>
                                        </div>
<div class="bg-slate-700/30 rounded-lg p-2">
                                            <p class="text-gray-400 text-xs mb-1 i18n" data-key="orderExpiration">Expiraci√≥n de √ìrdenes:</p>
                                            <p class="text-sm font-medium">{{ token.order_expiration if token.order_expiration is not none else 'N/A' }}</p>
                                        </div>
                                    </div>
                                    <div class="bg-slate-700/30 rounded-lg p-2 mt-2">
                                        <p class="text-gray-400 text-xs mb-1 i18n" data-key="dailyLossMax">P√©rdida Diaria M√°x:</p>
                                        <p class="text-sm font-medium">{{ token.daily_loss_max if token.daily_loss_max is not none else 'N/A' }}</p>
                                    </div>
                                {% endif %}

                                <!-- PnL para cualquier estrategia -->
                                <div class="mt-4 pt-4 border-t border-slate-700 flex items-center justify-between">
                                    <span class="text-sm font-medium i18n" data-key="pnl">PnL:</span>
                                    {% if token.strategy == 'infinity' %}
                                        {% if bot.get_infinity_roi(user_id, exchange_id, token.symbol) is defined %}
                                            <span class="text-lg font-bold {% if bot.get_infinity_roi(user_id, exchange_id, token.symbol) > 0 %}text-green-400{% elif bot.get_infinity_roi(user_id, exchange_id, token.symbol) < 0 %}text-red-400{% else %}text-gray-400{% endif %}">
                                                {{ bot.get_infinity_roi(user_id, exchange_id, token.symbol) }}%
                                            </span>
                                        {% else %}
                                            <span class="text-lg font-bold {% if exchange_pnl.get(token.symbol, 0) > 0 %}text-green-400{% elif exchange_pnl.get(token.symbol, 0) < 0 %}text-red-400{% else %}text-gray-400{% endif %}">
                                                {{ exchange_pnl.get(token.symbol, 0) }}
                                            </span>
                                        {% endif %}
                                    {% else %}
                                        <span class="text-lg font-bold {% if exchange_pnl.get(token.symbol, 0) > 0 %}text-green-400{% elif exchange_pnl.get(token.symbol, 0) < 0 %}text-red-400{% else %}text-gray-400{% endif %}">
                                            {{ exchange_pnl.get(token.symbol, 0) }}
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="flex flex-wrap gap-2 mt-4 pt-4 border-t border-slate-700">
                                <a href="{{ url_for('edit_token_route', exchange_id=exchange_id, old_symbol=token.symbol) }}"
                                   class="bg-blue-600/20 hover:bg-blue-600/30 text-blue-400 font-bold py-1 px-2 rounded-lg text-xs transition-colors flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                                    </svg>
                                    <span class="i18n" data-key="edit">Editar</span>
                                </a>
                                <form action="{{ url_for('delete_token_route', exchange_id=exchange_id, symbol=token.symbol) }}"
                                      method="post" class="inline-block">
                                    <button type="submit"
                                            class="bg-red-600/20 hover:bg-red-600/30 text-red-400 font-bold py-1 px-2 rounded-lg text-xs transition-colors flex items-center"
                                            onclick="return confirm(getTranslation('confirmDeleteToken'));">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                        </svg>
                                        <span class="i18n" data-key="delete">Eliminar</span>
                                    </button>
                                </form>
                                <form action="{{ url_for('toggle_token_route', exchange_id=exchange_id, symbol=token.symbol) }}"
                                      method="post" class="inline-block">
                                    <button type="submit"
                                            class="bg-yellow-600/20 hover:bg-yellow-600/30 text-yellow-400 font-bold py-1 px-2 rounded-lg text-xs transition-colors flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                                        </svg>
                                        <span class="i18n" data-key="{% if token.get('active_exchanges', {}).get(exchange_id, True) %}disable{% else %}enable{% endif %}">
                                            {% if token.get('active_exchanges', {}).get(exchange_id, True) %}
                                                Deshabilitar
                                            {% else %}
                                                Habilitar
                                            {% endif %}
                                        </span>
                                    </button>
                                </form>
                                {% set running = token_running_status.get(token.symbol, False) %}
                                <button type="button"
                                        id="token-run-{{ token.symbol | replace('/', '-') }}"
                                        data-exchange-id="{{ exchange_id }}"
                                        data-symbol="{{ token.symbol }}"
                                        class="{% if running %}bg-red-600/20 hover:bg-red-600/30 text-red-400{% else %}bg-green-600/20 hover:bg-green-600/30 text-green-400{% endif %} font-bold py-1 px-2 rounded-lg text-xs transition-colors flex items-center"
                                        onclick="toggleTokenStatus('{{ exchange_id }}', '{{ token.symbol }}')">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                        {% if running %}
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd" />
                                        {% else %}
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                                        {% endif %}
                                    </svg>
                                    <span class="i18n" data-key="{% if running %}stop{% else %}start{% endif %}">
                                        {% if running %}Detener{% else %}Iniciar{% endif %}
                                    </span>
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- Secci√≥n de √ìrdenes Abiertas -->
                    <div x-show="activeTab === 'orders'" class="space-y-6 animate-fade-in">
                        {% for symbol, orders in open_orders.items() %}
                        <div class="bg-slate-800/60 backdrop-blur-sm rounded-xl shadow-lg p-5 border border-slate-700 hover:border-slate-600 transition-colors animate-slide-up"
                             style="animation-delay: {{ loop.index0 * 100 }}ms;">
                            <h3 class="text-xl font-semibold mb-4 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.736 6.979C9.208 6.193 9.696 6 10 6c.304 0 .792.193 1.264.979a1 1 0 001.715-1.029C12.279 4.784 11.232 4 10 4s-2.279.784-2.979 1.95c-.285.475-.507 1-.67 1.55H6a1 1 0 000 2h.013a9.358 9.358 0 000 1H6a1 1 0 100 2h.351c.163.55.385 1.075.67 1.55C7.721 15.216 8.768 16 10 16s2.279-.784 2.979-1.95a1 1 0 10-1.715-1.029c-.472.786-.96.979-1.264.979-.304 0-.792-.193-1.264-.979a4.265 4.265 0 01-.264-.521H10a1 1 0 100-2H8.017a7.36 7.36 0 010-1H10a1 1 0 100-2H8.472c.08-.185.167-.36.264-.521z" clip-rule="evenodd" />
                                </svg>
                                {{ symbol }}
                            </h3>

                            <!-- √ìrdenes de Compra -->
                            <div class="mb-6">
                                <h4 class="text-lg font-semibold mb-2 text-green-400 flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z" clip-rule="evenodd" />
                                    </svg>
                                    <span class="i18n" data-key="buyOrders">√ìrdenes de Compra</span>
                                </h4>
                                <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
                                    {% for order in orders.buy.values() %}
                                    <div class="bg-slate-700/40 rounded-xl p-3 border border-slate-600/50 hover:border-slate-500/50 transition-colors">
                                        <div class="grid grid-cols-2 gap-2">
                                            <div>
                                                <p class="text-gray-400 text-xs mb-1 i18n" data-key="id">ID:</p>
                                                <p class="text-sm font-medium">{{ order.id | truncate(10, true, "") }}...</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-400 text-xs mb-1 i18n" data-key="amount">Cantidad:</p>
                                                <p class="text-sm font-medium">{{ order.amount }}</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-400 text-xs mb-1 i18n" data-key="price">Precio:</p>
                                                <p class="text-sm font-medium">{{ order.price }}</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-400 text-xs mb-1 i18n" data-key="status">Estado:</p>
                                                <p class="text-sm font-medium">{{ order.status }}</p>
                                            </div>
                                        </div>
                                        <form action="/cancel_order" method="post" class="mt-3">
                                            <input type="hidden" name="exchange_id" value="{{ exchange_id }}">
                                            <input type="hidden" name="symbol" value="{{ symbol }}">
                                            <input type="hidden" name="order_id" value="{{ order.id }}">
                                            <button type="submit"
                                                    class="bg-red-600/20 hover:bg-red-600/30 text-red-400 font-bold py-1.5 px-3 rounded-lg text-xs transition-colors w-full flex items-center justify-center">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                                                </svg>
                                                <span class="i18n" data-key="cancel">Cancelar</span>
                                            </button>
                                        </form>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>

                            <!-- √ìrdenes de Venta -->
                            <div>
                                <h4 class="text-lg font-semibold mb-2 text-red-400 flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                    </svg>
                                    <span class="i18n" data-key="sellOrders">√ìrdenes de Venta</span>
                                </h4>
                                <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
                                    {% for order in orders.sell.values() %}
                                    <div class="bg-slate-700/40 rounded-xl p-3 border border-slate-600/50 hover:border-slate-500/50 transition-colors">
                                        <div class="grid grid-cols-2 gap-2">
                                            <div>
                                                <p class="text-gray-400 text-xs mb-1 i18n" data-key="id">ID:</p>
                                                <p class="text-sm font-medium">{{ order.id | truncate(10, true, "") }}...</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-400 text-xs mb-1 i18n" data-key="amount">Cantidad:</p>
                                                <p class="text-sm font-medium">{{ order.amount }}</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-400 text-xs mb-1 i18n" data-key="price">Precio:</p>
                                                <p class="text-sm font-medium">{{ order.price }}</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-400 text-xs mb-1 i18n" data-key="status">Estado:</p>
                                                <p class="text-sm font-medium">{{ order.status }}</p>
                                            </div>
                                        </div>
                                        <form action="/cancel_order" method="post" class="mt-3">
                                            <input type="hidden" name="exchange_id" value="{{ exchange_id }}">
                                            <input type="hidden" name="symbol" value="{{ symbol }}">
                                            <input type="hidden" name="order_id" value="{{ order.id }}">
                                            <button type="submit"
                                                    class="bg-red-600/20 hover:bg-red-600/30 text-red-400 font-bold py-1.5 px-3 rounded-lg text-xs transition-colors w-full flex items-center justify-center">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                                                </svg>
                                                <span class="i18n" data-key="cancel">Cancelar</span>
                                            </button>
                                        </form>
                                    </div>
                                    {% endfor %}
                                </div>
                                <!-- Bot√≥n para borrar √≥rdenes de venta pendientes -->
                                <div class="mt-4">
                                    <form id="clear-sell-form-{{ symbol | replace('/', '-') }}" onsubmit="return clearPendingSellOrders('{{ exchange_id }}', '{{ symbol }}')">
                                        <button type="submit" class="bg-gradient-to-r from-red-600 to-rose-600 hover:from-red-700 hover:to-rose-700 text-white font-bold py-2 px-4 rounded-xl shadow-lg shadow-red-600/20 transition-all duration-300 ease-in-out transform hover:scale-105 flex items-center justify-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                            </svg>
                                            <span class="i18n" data-key="clearPendingSellOrders">Borrar √ìrdenes de Venta Pendientes</span>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="fixed bottom-4 right-4 flex flex-col space-y-2">
        <a href="https://chatgpt.com/g/g-67701000b5e88191afa7fbef8a1789fa-botxi-help" target="_blank"
           class="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold py-2 px-4 rounded-xl shadow-lg shadow-blue-600/20 transition-all duration-300 ease-in-out transform hover:scale-105 flex items-center space-x-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
            </svg>
            <span class="i18n" data-key="tutorial">Tutorial</span>
        </a>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script>
        // Traducciones
        const translations = {
            es: {
                backToHome: "Volver al Inicio",
                exchange: "Exchange",
                active: "Activo",
                inactive: "Inactivo",
                tokens: "Tokens",
                openOrders: "√ìrdenes Abiertas",
                buyOrders: "√ìrdenes de Compra",
                sellOrders: "√ìrdenes de Venta",
                clearPendingSellOrders: "Borrar √ìrdenes de Venta Pendientes",
                addToken: "Agregar Token",
                detailedPnL: "Ver PnL Detallado",
                strategy: "Estrategia",
                spread: "Spread",
                takeProfit: "Take Profit",
                tradeAmount: "Cantidad de Trade",
                maxOrders: "M√°x √ìrdenes",
                maxSellOrders: "M√°x √ìrdenes de Venta",
                orderExpiration: "Expiraci√≥n de √ìrdenes",
                dailyLossMax: "P√©rdida Diaria M√°x",
                initialCapital: "Capital Inicial",
                reinvestmentPct: "% Reinversi√≥n",
                maxReinvestment: "M√°x. Reinversi√≥n",
                reservePct: "% Reserva",
                totalBalanceUsdt: "Capital Total (USDT)",
                gridInterval: "Intervalo de Grilla",
                minPrice: "Precio M√≠nimo",
                checkInterval: "Intervalo de Revisi√≥n (s)",
                commission: "Comisi√≥n",
                pnl: "PnL",
                edit: "Editar",
                delete: "Eliminar",
                disable: "Deshabilitar",
                enable: "Habilitar",
                start: "Iniciar",
                stop: "Detener",
                id: "ID",
                amount: "Cantidad",
                price: "Precio",
                status: "Estado",
                cancel: "Cancelar",
                tutorial: "Tutorial",
                confirmDeleteToken: "¬øEst√°s seguro de eliminar este token?"
            },
            en: {
                backToHome: "Back to Home",
                exchange: "Exchange",
                active: "Active",
                inactive: "Inactive",
                tokens: "Tokens",
                openOrders: "Open Orders",
                buyOrders: "Buy Orders",
                sellOrders: "Sell Orders",
                clearPendingSellOrders: "Clear Pending Sell Orders",
                addToken: "Add Token",
                detailedPnL: "View Detailed PnL",
                strategy: "Strategy",
                spread: "Spread",
                takeProfit: "Take Profit",
                tradeAmount: "Trade Amount",
                maxOrders: "Max Orders",
                maxSellOrders: "Max Sell Orders",
                orderExpiration: "Order Expiration",
                dailyLossMax: "Max Daily Loss",
                initialCapital: "Initial Capital",
                reinvestmentPct: "Reinvestment %",
                maxReinvestment: "Max. Reinvestment",
                reservePct: "Reserve %",
                totalBalanceUsdt: "Total Balance (USDT)",
                gridInterval: "Grid Interval",
                minPrice: "Min Price",
                checkInterval: "Check Interval (s)",
                commission: "Commission",
                pnl: "PnL",
                edit: "Edit",
                delete: "Delete",
                disable: "Disable",
                enable: "Enable",
                start: "Start",
                stop: "Stop",
                id: "ID",
                amount: "Amount",
                price: "Price",
                status: "Status",
                cancel: "Cancel",
                tutorial: "Tutorial",
                confirmDeleteToken: "Are you sure you want to delete this token?"
            },
            pt: {
                backToHome: "Voltar ao In√≠cio",
                exchange: "Exchange",
                active: "Ativo",
                inactive: "Inativo",
                tokens: "Tokens",
                openOrders: "Ordens Abertas",
                buyOrders: "Ordens de Compra",
                sellOrders: "Ordens de Venda",
                clearPendingSellOrders: "Limpar Ordens de Venda Pendentes",
                addToken: "Adicionar Token",
                detailedPnL: "Ver PnL Detalhado",
                strategy: "Estrat√©gia",
                spread: "Spread",
                takeProfit: "Take Profit",
                tradeAmount: "Quantidade de Trade",
                maxOrders: "M√°x Ordens",
                maxSellOrders: "M√°x Ordens de Venda",
                orderExpiration: "Expira√ß√£o de Ordens",
                dailyLossMax: "Perda Di√°ria M√°x",
                initialCapital: "Capital Inicial",
                reinvestmentPct: "% Reinvestimento",
                maxReinvestment: "M√°x. Reinvestimento",
                reservePct: "% Reserva",
                totalBalanceUsdt: "Capital Total (USDT)",
                gridInterval: "Intervalo de Grade",
                minPrice: "Pre√ßo M√≠nimo",
                checkInterval: "Intervalo de Verifica√ß√£o (s)",
                commission: "Comiss√£o",
                pnl: "PnL",
                edit: "Editar",
                delete: "Excluir",
                disable: "Desabilitar",
                enable: "Habilitar",
                start: "Iniciar",
                stop: "Parar",
                id: "ID",
                amount: "Quantidade",
                price: "Pre√ßo",
                status: "Estado",
                cancel: "Cancelar",
                tutorial: "Tutorial",
                confirmDeleteToken: "Tem certeza que deseja excluir este token?"
            }
        };

        // Nombres de temas por idioma
        const themeNames = {
            es: {
                dark: "Oscuro",
                light: "Claro",
                "blue-eye": "Azul"
            },
            en: {
                dark: "Dark",
                light: "Light",
                "blue-eye": "Blue Eye"
            },
            pt: {
                dark: "Escuro",
                light: "Claro",
                "blue-eye": "Azul"
            }
        };

        // Inicializar configuraci√≥n
        let currentLang = localStorage.getItem('botxi-language') || 'es';
        let currentTheme = localStorage.getItem('botxi-theme') || 'dark';

        // Funciones para manejar idiomas
        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('botxi-language', lang);
            document.documentElement.setAttribute('lang', lang);

            // Actualizar todos los elementos traducibles
            document.querySelectorAll('.i18n').forEach(el => {
                const key = el.getAttribute('data-key');
                if (key && translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });

            // Actualizar texto del bot√≥n de idioma
            const langButton = document.getElementById('language-button');
            const langEmoji = lang === 'es' ? 'üá™üá∏' : lang === 'en' ? 'üá∫üá∏' : 'üáßüá∑';
            const langName = lang === 'es' ? 'Espa√±ol' : lang === 'en' ? 'English' : 'Portugu√™s';
            langButton.querySelector('.language-text').textContent = `${langEmoji} ${langName}`;

            // Actualizar nombres de temas en el men√∫
            document.querySelectorAll('.theme-name').forEach(el => {
                const themeId = el.closest('.theme-option').getAttribute('data-theme');
                el.textContent = themeNames[lang][themeId];
            });

            // Actualizar texto del bot√≥n de tema
            const themeButton = document.getElementById('theme-button');
            const themeEmoji = currentTheme === 'dark' ? 'üåë' : currentTheme === 'light' ? '‚òÄÔ∏è' : 'üëÅÔ∏è';
const themeName = themeNames[lang][currentTheme];
            themeButton.querySelector('.theme-text').textContent = `${themeEmoji} ${themeName}`;
        }

        function setTheme(theme) {
            currentTheme = theme;
            localStorage.setItem('botxi-theme', theme);

            const body = document.getElementById('app-body');
            document.documentElement.className = theme;

            // Aplicar clases espec√≠ficas seg√∫n el tema
            if (theme === 'dark') {
                body.className = 'bg-slate-900 text-gray-100 font-sans transition-colors duration-300';
                document.querySelector('nav').className = 'sticky top-0 z-50 backdrop-blur-md bg-slate-900/80 border-b border-slate-800 shadow-md transition-colors';
            } else if (theme === 'light') {
                body.className = 'bg-white text-slate-900 font-sans transition-colors duration-300';
                document.querySelector('nav').className = 'sticky top-0 z-50 backdrop-blur-md bg-white/80 border-b border-slate-300 shadow-md text-slate-900 transition-colors';
            } else if (theme === 'blue-eye') {
                body.className = 'bg-blueEye-900 text-blueEye-100 font-sans transition-colors duration-300';
                document.querySelector('nav').className = 'sticky top-0 z-50 backdrop-blur-md bg-blueEye-900/80 border-b border-blueEye-800 shadow-md transition-colors';
            }

            // Actualizar texto del bot√≥n de tema
            const themeButton = document.getElementById('theme-button');
            const themeEmoji = theme === 'dark' ? 'üåë' : theme === 'light' ? '‚òÄÔ∏è' : 'üëÅÔ∏è';
            const themeName = themeNames[currentLang][theme];
            themeButton.querySelector('.theme-text').textContent = `${themeEmoji} ${themeName}`;
        }

        // Obtener traducci√≥n para un key espec√≠fico
        function getTranslation(key) {
            return translations[currentLang][key] || key;
        }

        // Inicializar UI
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar idioma y tema
            setLanguage(currentLang);
            setTheme(currentTheme);

            // Configurar toastr
            toastr.options = {
                "closeButton": true,
                "positionClass": "toast-top-right",
                "progressBar": true,
                "timeOut": "5000"
            };

            // Configurar eventos para el selector de idioma
            const langButton = document.getElementById('language-button');
            const langDropdown = document.getElementById('language-dropdown');

            langButton.addEventListener('click', function() {
                langDropdown.classList.toggle('hidden');
            });

            document.querySelectorAll('.language-option').forEach(option => {
                option.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    setLanguage(lang);
                    langDropdown.classList.add('hidden');
                });
            });

            // Configurar eventos para el selector de tema
            const themeButton = document.getElementById('theme-button');
            const themeDropdown = document.getElementById('theme-dropdown');

            themeButton.addEventListener('click', function() {
                themeDropdown.classList.toggle('hidden');
            });

            document.querySelectorAll('.theme-option').forEach(option => {
                option.addEventListener('click', function() {
                    const theme = this.getAttribute('data-theme');
                    setTheme(theme);
                    themeDropdown.classList.add('hidden');
                });
            });

            // Cerrar dropdowns al hacer clic fuera
            document.addEventListener('click', function(event) {
                if (!event.target.closest('#language-selector')) {
                    langDropdown.classList.add('hidden');
                }
                if (!event.target.closest('#theme-selector')) {
                    themeDropdown.classList.add('hidden');
                }
            });

            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    toastr["{{ 'error' if category == 'error' else 'success' }}"](
                        "{{ message }}"
                    );
                {% endfor %}
            {% endif %}
            {% endwith %}
        });

        // Funci√≥n para toggle token status
        function toggleTokenStatus(exchangeId, symbol) {
            const safeSymbol = symbol.replace('/', '-');
            const button = document.getElementById(`token-run-${safeSymbol}`);
            const currentText = button.querySelector('span').textContent.trim();
            const isStarting = (currentText === getTranslation('start'));
            const endpoint = isStarting ? '/start_token' : '/stop_token';

            // Construir FormData para manejar correctamente los caracteres especiales en symbol
            const formData = new FormData();
            formData.append('exchange_id', exchangeId);
            formData.append('symbol', symbol);

            fetch(endpoint, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Actualizar la interfaz
                    updateTokenStatus(safeSymbol, exchangeId, symbol, isStarting);
                    toastr.success(data.message);
                } else {
                    toastr.error(data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                toastr.error(getTranslation('errorChangingTokenStatus'));
            });
        }

        // Actualizar la UI cuando cambia el estado
        function updateTokenStatus(safeSymbol, exchangeId, symbol, isActive) {
            const button = document.getElementById(`token-run-${safeSymbol}`);

            if (isActive) {
                // Cambiar a estado activo (bot√≥n rojo de detener)
                button.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd" />
                    </svg>
                    <span class="i18n" data-key="stop">${getTranslation('stop')}</span>
                `;
                button.className = 'bg-red-600/20 hover:bg-red-600/30 text-red-400 font-bold py-1 px-2 rounded-lg text-xs transition-colors flex items-center';
            } else {
                // Cambiar a estado inactivo (bot√≥n verde de iniciar)
                button.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                    </svg>
                    <span class="i18n" data-key="start">${getTranslation('start')}</span>
                `;
                button.className = 'bg-green-600/20 hover:bg-green-600/30 text-green-400 font-bold py-1 px-2 rounded-lg text-xs transition-colors flex items-center';
            }
        }

        // Funci√≥n para borrar √≥rdenes pendientes de venta
        function clearPendingSellOrders(exchangeId, symbol) {
            event.preventDefault();

            if (!confirm(getTranslation('confirmClearSellOrders'))) {
                return false;
            }

            const formData = new FormData();
            formData.append('exchange_id', exchangeId);
            formData.append('symbol', symbol);

            fetch('/clear_pending_sell_orders', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                toastr.success(data.message);
                setTimeout(() => {
                    location.reload();
                }, 1500);
            })
            .catch(error => {
                console.error('Error:', error);
                toastr.error(getTranslation('errorClearingSellOrders'));
            });

            return false;
        }

        // Configurar polling para actualizar el estado de los tokens
        function pollTokenStatus() {
            const tokenButtons = document.querySelectorAll('[id^="token-run-"]');

            tokenButtons.forEach(button => {
                const exchangeId = button.getAttribute('data-exchange-id');
                const symbol = button.getAttribute('data-symbol');

                fetch(`/token_status?exchange_id=${exchangeId}&symbol=${encodeURIComponent(symbol)}`)
                .then(response => response.json())
                .then(data => {
                    const safeSymbol = symbol.replace('/', '-');
                    if (data.running !== undefined) {
                        updateTokenStatus(safeSymbol, exchangeId, symbol, data.running);
                    }
                })
                .catch(error => console.error(`Error actualizando estado del token ${symbol}:`, error));
            });
        }

        // Iniciar polling al cargar la p√°gina
        setInterval(pollTokenStatus, 5000);
    </script>
</body>
</html>