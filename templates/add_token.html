<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <title>Agregar Token al Exchange {{ exchange_id }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            "50": "#f0f9ff",
                            "100": "#e0f2fe",
                            "200": "#bae6fd",
                            "300": "#7dd3fc",
                            "400": "#38bdf8",
                            "500": "#0ea5e9",
                            "600": "#0284c7",
                            "700": "#0369a1",
                            "800": "#075985",
                            "900": "#0c4a6e",
                            "950": "#082f49"
                        },
                        blueEye: {
                            "50": "#f0f9ff",
                            "100": "#e0f7ff",
                            "200": "#c0e8ff",
                            "300": "#99d5ff",
                            "400": "#5aafff",
                            "500": "#3b82f6",
                            "600": "#1d4ed8",
                            "700": "#1e40af",
                            "800": "#1e3a8a",
                            "900": "#172554"
                        }
                    },
                    fontFamily: {
                        'sans': ['Poppins', 'ui-sans-serif', 'system-ui', '-apple-system',
                                 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue',
                                 'Arial', 'Noto Sans', 'sans-serif', 'Apple Color Emoji',
                                 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.5s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                    },
                }
            }
        }
    </script>
    <style>
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .gradient-bg {
            background: linear-gradient(-45deg, #7038ff, #00a3ff, #3b82f6, #5f8fff);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        .description {
            font-size: 0.875rem;
            color: #9ca3af;
            margin-top: 0.25rem;
        }
    </style>
</head>

<body class="bg-slate-900 text-gray-100 font-sans min-h-screen">
    <!-- Barra de navegaci√≥n con selecci√≥n de idioma y tema -->
    <nav class="sticky top-0 z-50 backdrop-blur-md bg-slate-900/80 border-b border-slate-800 shadow-md">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="text-2xl font-bold bg-clip-text text-transparent gradient-bg">BOTXI</div>
                    <span class="bg-blue-600 text-xs px-2 py-1 rounded-full animate-pulse">Beta</span>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Selector de idioma -->
                    <div class="relative" id="language-selector">
                        <button class="flex items-center space-x-1 text-sm bg-slate-800 hover:bg-slate-700 rounded-lg px-3 py-2 transition-colors" id="language-button">
                            <span class="language-text">üá™üá∏ Espa√±ol</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div class="absolute right-0 mt-2 bg-slate-800 rounded-lg shadow-lg p-2 hidden w-36 z-10" id="language-dropdown">
                            <button data-lang="es" class="language-option block w-full text-left px-3 py-2 rounded hover:bg-slate-700 text-sm">üá™üá∏ Espa√±ol</button>
                            <button data-lang="en" class="language-option block w-full text-left px-3 py-2 rounded hover:bg-slate-700 text-sm">üá∫üá∏ English</button>
                            <button data-lang="pt" class="language-option block w-full text-left px-3 py-2 rounded hover:bg-slate-700 text-sm">üáßüá∑ Portugu√™s</button>
                        </div>
                    </div>

                    <!-- Selector de tema -->
                    <div class="relative" id="theme-selector">
                        <button class="flex items-center space-x-1 text-sm bg-slate-800 hover:bg-slate-700 rounded-lg px-3 py-2 transition-colors" id="theme-button">
                            <span class="theme-text">üåë Oscuro</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div class="absolute right-0 mt-2 bg-slate-800 rounded-lg shadow-lg p-2 hidden w-36 z-10" id="theme-dropdown">
                            <button data-theme="dark" class="theme-option block w-full text-left px-3 py-2 rounded hover:bg-slate-700 text-sm">üåë <span class="theme-name">Oscuro</span></button>
                            <button data-theme="light" class="theme-option block w-full text-left px-3 py-2 rounded hover:bg-slate-700 text-sm">‚òÄÔ∏è <span class="theme-name">Claro</span></button>
                            <button data-theme="blue-eye" class="theme-option block w-full text-left px-3 py-2 rounded hover:bg-slate-700 text-sm">üëÅÔ∏è <span class="theme-name">Azul</span></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8 max-w-2xl">
        <h1 class="text-4xl font-bold mb-8 text-center text-transparent bg-clip-text gradient-bg">
            <span class="i18n" data-key="addToken">Agregar Token al Exchange {{ exchange_id }}</span>
        </h1>

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <ul class="mb-6 animate-slide-up">
              {% for category, message in messages %}
                <li class="p-4 mb-4 text-sm rounded-xl
                           {% if category == 'error' %}
                              bg-red-900/30 text-red-200 border border-red-700
                           {% else %}
                              bg-green-900/30 text-green-200 border border-green-700
                           {% endif %}
                           animate-fade-in">
                  {{ message }}
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        {% endwith %}

        <form action="{{ url_for('add_token_route', exchange_id=exchange_id) }}"
              method="post"
              id="tokenForm"
              class="space-y-6 bg-slate-800/60 backdrop-blur-sm p-6 rounded-xl shadow-xl border border-slate-700 animate-fade-in">

            <!-- S√≠mbolo -->
            <div>
                <label for="symbol" class="block text-sm font-medium text-gray-300 mb-1">
                    <span class="i18n" data-key="symbol">S√≠mbolo:</span>
                </label>
                <input
                    type="text"
                    id="symbol"
                    name="symbol"
                    required
                    class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                           text-white placeholder-gray-400 focus:outline-none
                           focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                           transition-colors duration-200">
                <p id="desc_symbol" class="description">Ejemplo: BTC/USDT. El par de trading con el formato exacto del exchange.</p>
            </div>

            <!-- Seleccionar Exchanges -->
            <div>
                <label for="exchanges" class="block text-sm font-medium text-gray-300 mb-1">
                    <span class="i18n" data-key="selectExchanges">Seleccionar Exchanges:</span>
                </label>
                <select
                    id="exchanges"
                    name="exchanges"
                    multiple
                    required
                    class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                           text-white focus:outline-none focus:ring-2 focus:ring-blue-500
                           focus:border-blue-500 transition-colors duration-200">
                    {% for ex_id, exchange_info in exchanges_config.items() %}
                        <option value="{{ ex_id }}">{{ exchange_info.name }}</option>
                    {% endfor %}
                </select>
                <p id="desc_exchanges" class="description">Selecciona en qu√© exchange(s) quieres usar este token.</p>
            </div>

            <!-- Estrategia -->
            <div>
                <label for="strategy" class="block text-sm font-medium text-gray-300 mb-1">
                    <span class="i18n" data-key="strategy">Estrategia:</span>
                </label>
                <select
                    id="strategy"
                    name="strategy"
                    onchange="updateFields(); updateDescriptions();"
                    required
                    class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                           text-white focus:outline-none focus:ring-2 focus:ring-blue-500
                           focus:border-blue-500 transition-colors duration-200">
                    <option value="strategy1">Grilla ML</option>
                    <option value="strategy2">Reinversi√≥n</option>
                    <option value="compound">Compound</option>
                    <option value="infinity">Infinity</option>
                </select>
                <p id="desc_strategy" class="description">Selecciona la estrategia de trading para este token.</p>
            </div>

            <!-- Campos comunes para todas las estrategias -->
            <div>
                <label for="daily_loss_max" class="block text-sm font-medium text-gray-300 mb-1">
                    <span class="i18n" data-key="dailyLossMax">M√°ximo de P√©rdida Diaria (%):</span>
                </label>
                <input
                    type="number"
                    step="0.001"
                    id="daily_loss_max"
                    name="daily_loss_max"
                    required
                    class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                           text-white placeholder-gray-400 focus:outline-none
                           focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                           transition-colors duration-200">
                <p id="desc_daily_loss_max" class="description">Porcentaje de ca√≠da diaria para pausar la estrategia. Ej: 10 => 10%.</p>
            </div>

            <div>
                <label for="reactivation_threshold" class="block text-sm font-medium text-gray-300 mb-1">
                    <span class="i18n" data-key="reactivationThreshold">Umbral de Reactivaci√≥n (%):</span>
                </label>
                <input
                    type="number"
                    step="0.01"
                    name="reactivation_threshold"
                    id="reactivation_threshold"
                    required
                    class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                           text-white placeholder-gray-400 focus:outline-none
                           focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                           transition-colors duration-200">
                <p id="desc_reactivation_threshold" class="description">Si el mercado se recupera este %, el bot se reanuda. Ej: 5 => 5%.</p>
            </div>

            <!-- Campos para estrategias normales -->
            <div id="commonFields">
                <!-- Spread -->
                <div id="spreadField">
                    <label for="spread" class="block text-sm font-medium text-gray-300 mb-1">
                        <span class="i18n" data-key="spread">Spread (%):</span>
                    </label>
                    <input
                        type="number"
                        step="0.000001"
                        id="spread"
                        name="spread"
                        disabled
                        class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                               text-white placeholder-gray-400 focus:outline-none
                               focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                               transition-colors duration-200">
                    <p id="desc_spread" class="description">Porcentaje entre el precio de compra y venta en la grilla. Ej: 0.1 => 10%.</p>
                </div>

                <!-- Take Profit -->
                <div id="take_profitField">
                    <label for="take_profit" class="block text-sm font-medium text-gray-300 mb-1">
                        <span class="i18n" data-key="takeProfit">Take Profit (%):</span>
                    </label>
                    <input
                        type="number"
                        step="0.000001"
                        id="take_profit"
                        name="take_profit"
                        disabled
                        class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                               text-white placeholder-gray-400 focus:outline-none
                               focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                               transition-colors duration-200">
                    <p id="desc_take_profit" class="description">Porcentaje de ganancia para cerrar la venta. Ej: 0.05 => 5%.</p>
                </div>

                <!-- Cantidad de Trade -->
                <div id="trade_amountField">
                    <label for="trade_amount" class="block text-sm font-medium text-gray-300 mb-1">
                        <span class="i18n" data-key="tradeAmount">Cantidad de Trade:</span>
                    </label>
                    <input
                        type="number"
                        step="0.000001"
                        id="trade_amount"
                        name="trade_amount"
                        class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                               text-white placeholder-gray-400 focus:outline-none
                               focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                               transition-colors duration-200">
                    <p id="desc_trade_amount" class="description">Cantidad fija por trade. Ej: 0.002 BTC.</p>
                    <div id="tradeAmountError" class="text-red-500 text-sm mt-1 hidden">
                        Este campo es requerido para la estrategia seleccionada
                    </div>
                </div>

                <!-- M√°x √ìrdenes Compra -->
                <div id="max_ordersField">
                    <label for="max_orders" class="block text-sm font-medium text-gray-300 mb-1">
                        <span class="i18n" data-key="maxOrders">N√∫mero M√°ximo de √ìrdenes Compra:</span>
                    </label>
                    <input
                        type="number"
                        id="max_orders"
                        name="max_orders"
                        disabled
                        class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                               text-white placeholder-gray-400 focus:outline-none
                               focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                               transition-colors duration-200">
                    <p id="desc_max_orders" class="description">M√°x √≥rdenes de compra simult√°neas. Ej: 5.</p>
                </div>

                <!-- M√°x √ìrdenes Venta -->
                <div id="max_sell_ordersField">
                    <label for="max_sell_orders" class="block text-sm font-medium text-gray-300 mb-1">
                        <span class="i18n" data-key="maxSellOrders">N√∫mero M√°ximo de √ìrdenes de Venta:</span>
                    </label>
                    <input
                        type="number"
                        id="max_sell_orders"
                        name="max_sell_orders"
                        disabled
                        class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                               text-white placeholder-gray-400 focus:outline-none
                               focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                               transition-colors duration-200">
                    <p id="desc_max_sell_orders" class="description">M√°x √≥rdenes de venta simult√°neas. Ej: 3.</p>
                </div>

                <!-- Expiraci√≥n de √ìrdenes -->
                <div id="order_expirationField">
                    <label for="order_expiration" class="block text-sm font-medium text-gray-300 mb-1">
                        <span class="i18n" data-key="orderExpiration">Tiempo de Expiraci√≥n de √ìrdenes (minutos):</span>
                    </label>
                    <input
                        type="number"
                        id="order_expiration"
                        name="order_expiration"
                        disabled
                        class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                               text-white placeholder-gray-400 focus:outline-none
                               focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                               transition-colors duration-200">
                    <p id="desc_order_expiration" class="description">Si la orden no se ejecuta antes del tiempo establecido, se cancela.</p>
                </div>
            </div>

            <!-- Campos para Compound -->
            <div id="compoundFields" class="hidden">
                <!-- Capital Inicial -->
                <div id="initial_capitalField">
                    <label for="initial_capital" class="block text-sm font-medium text-gray-300 mb-1">
                        <span class="i18n" data-key="initialCapital">Capital Inicial (USDT):</span>
                    </label>
                    <input
                        type="number"
                        step="0.01"
                        id="initial_capital"
                        name="initial_capital"
                        disabled
                        class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                               text-white placeholder-gray-400 focus:outline-none
                               focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                               transition-colors duration-200">
                    <p id="desc_initial_capital" class="description">Capital inicial asignado. Ej: 500 USDT.</p>
                </div>

                <!-- Porcentaje de Reinversi√≥n -->
                <div id="reinvestment_percentageField">
                    <label for="reinvestment_percentage" class="block text-sm font-medium text-gray-300 mb-1">
                        <span class="i18n" data-key="reinvestmentPercentage">Porcentaje de Reinversi√≥n (%):</span>
                    </label>
                    <input
                        type="number"
                        step="0.01"
                        id="reinvestment_percentage"
                        name="reinvestment_percentage"
                        value="75.0"
                        disabled
                        class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                               text-white placeholder-gray-400 focus:outline-none
                               focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                               transition-colors duration-200">
                    <p id="desc_reinvestment_percentage" class="description">Porcentaje de ganancia a reinvertir en cada ciclo. Ej: 75 => 75%.</p>
                </div>

                <!-- M√°ximo Reinversi√≥n -->
                <div id="max_reinvestment_pctField">
                    <label for="max_reinvestment_pct" class="block text-sm font-medium text-gray-300 mb-1">
                        <span class="i18n" data-key="maxReinvestmentPct">M√°ximo de Reinversi√≥n (%):</span>
                    </label>
                    <input
                        type="number"
                        step="0.01"
                        id="max_reinvestment_pct"
                        name="max_reinvestment_pct"
                        value="50.0"
                        disabled
                        class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                               text-white placeholder-gray-400 focus:outline-none
                               focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                               transition-colors duration-200">
                    <p id="desc_max_reinvestment_pct" class="description">L√≠mite m√°ximo de reinversi√≥n acumulada. Ej: 50 => 50%.</p>
                </div>

                <!-- Porcentaje de Reserva -->
                <div id="reserve_percentageField">
                    <label for="reserve_percentage" class="block text-sm font-medium text-gray-300 mb-1">
                        <span class="i18n" data-key="reservePercentage">Porcentaje de Reserva (%):</span>
                    </label>
                    <input
                        type="number"
                        step="0.01"
                        id="reserve_percentage"
                        name="reserve_percentage"
                        value="20.0"
                        disabled
                        class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                               text-white placeholder-gray-400 focus:outline-none
                               focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                               transition-colors duration-200">
                    <p id="desc_reserve_percentage" class="description">Porcentaje que se mantiene como reserva y no se reinvierte. Ej: 20 => 20%.</p>
                </div>
            </div>

            <!-- Campos para Infinity -->
            <div id="infinityFields" class="hidden">
                <div>
                    <label for="total_balance_usdt" class="block text-sm font-medium text-gray-300 mb-1">
                        <span class="i18n" data-key="totalBalanceUsdt">Capital Total (USDT):</span>
                    </label>
                    <input
                        type="number"
                        step="0.000001"
                        id="total_balance_usdt"
                        name="total_balance_usdt"
                        disabled
                        class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                               text-white placeholder-gray-400 focus:outline-none
                               focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                               transition-colors duration-200"
                        placeholder="Ej: 1000">
                    <p id="desc_total_balance_usdt" class="description">Capital total asignado para Infinity. Ej: 1000 USDT.</p>
                </div>

                <div>
                    <label for="grid_interval" class="block text-sm font-medium text-gray-300 mb-1">
                        <span class="i18n" data-key="gridInterval">Intervalo de Grilla:</span>
                    </label>
                    <input
                        type="number"
                        step="0.0001"
                        id="grid_interval"
                        name="grid_interval"
                        disabled
                        class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                               text-white placeholder-gray-400 focus:outline-none
                               focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                               transition-colors duration-200"
                        placeholder="Ej: 0.002">
                    <p id="desc_grid_interval" class="description">Intervalo de grilla. Ej: 0.002 (0.2%).</p>
                </div>

                <div>
                    <label for="min_price" class="block text-sm font-medium text-gray-300 mb-1">
                        <span class="i18n" data-key="minPrice">Precio M√≠nimo:</span>
                    </label>
                    <input
                        type="number"
                        step="0.000001"
                        id="min_price"
                        name="min_price"
                        disabled
                        class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                               text-white placeholder-gray-400 focus:outline-none
                               focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                               transition-colors duration-200"
                        placeholder="Ej: 8000">
                    <p id="desc_min_price" class="description">Precio m√≠nimo para iniciar la grilla. Ej: 8000 USDT.</p>
                </div>

                <div>
                    <label for="check_interval" class="block text-sm font-medium text-gray-300 mb-1">
                        <span class="i18n" data-key="checkInterval">Intervalo de Revisi√≥n (s):</span>
                    </label>
                    <input
                        type="number"
                        step="1"
                        id="check_interval"
                        name="check_interval"
                        disabled
                        class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                               text-white placeholder-gray-400 focus:outline-none
                               focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                               transition-colors duration-200"
                        placeholder="Ej: 5">
                    <p id="desc_check_interval" class="description">Intervalo en segundos para revisar y ajustar la grilla. Ej: 5.</p>
                </div>

                <div>
                    <label for="commission" class="block text-sm font-medium text-gray-300 mb-1">
                        <span class="i18n" data-key="commission">Comisi√≥n (%):</span>
                    </label>
                    <input
                        type="number"
                        step="0.00001"
                        id="commission"
                        name="commission"
                        disabled
                        class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                               text-white placeholder-gray-400 focus:outline-none
                               focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                               transition-colors duration-200"
                        placeholder="Ej: 0.001">
                    <p id="desc_commission" class="description">Comisi√≥n por operaci√≥n. Ej: 0.001 (0.1%).</p>
                </div>

                <!-- NUEVOS CAMPOS PARA REINVERSI√ìN EN INFINITY -->
                <div>
                    <label for="inf_reinvestment_percentage" class="block text-sm font-medium text-gray-300 mb-1">
                        <span class="i18n" data-key="reinvestmentPercentage">Porcentaje de Reinversi√≥n (%):</span>
                    </label>
                    <input
                        type="number"
                        step="0.01"
                        id="inf_reinvestment_percentage"
                        name="reinvestment_percentage"
                        value="75.0"
                        disabled
class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                               text-white placeholder-gray-400 focus:outline-none
                               focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                               transition-colors duration-200">
                    <p id="desc_inf_reinvestment_percentage" class="description">Reinversi√≥n de ganancias en Infinity. Ej: 75 => 75%.</p>
                </div>
                <div>
                    <label for="inf_max_reinvestment_pct" class="block text-sm font-medium text-gray-300 mb-1">
                        <span class="i18n" data-key="maxReinvestmentPct">M√°ximo de Reinversi√≥n (%):</span>
                    </label>
                    <input
                        type="number"
                        step="0.01"
                        id="inf_max_reinvestment_pct"
                        name="max_reinvestment_pct"
                        value="50.0"
                        disabled
                        class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                               text-white placeholder-gray-400 focus:outline-none
                               focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                               transition-colors duration-200">
                    <p id="desc_inf_max_reinvestment_pct" class="description">L√≠mite m√°ximo de reinversi√≥n acumulada en Infinity. Ej: 50 => 50%.</p>
                </div>
                <div>
                    <label for="inf_reserve_percentage" class="block text-sm font-medium text-gray-300 mb-1">
                        <span class="i18n" data-key="reservePercentage">Porcentaje de Reserva (%):</span>
                    </label>
                    <input
                        type="number"
                        step="0.01"
                        id="inf_reserve_percentage"
                        name="reserve_percentage"
                        value="20.0"
                        disabled
                        class="w-full px-3 py-2 bg-slate-700/80 border border-slate-600 rounded-lg
                               text-white placeholder-gray-400 focus:outline-none
                               focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                               transition-colors duration-200">
                    <p id="desc_inf_reserve_percentage" class="description">Porcentaje reservado de ganancias en Infinity. Ej: 20 => 20%.</p>
                </div>
            </div>

            <!-- Bot√≥n para guardar -->
            <div class="mt-6">
                <button
                    type="submit"
                    class="w-full bg-gradient-to-r from-blue-600 to-violet-600 hover:from-blue-700 hover:to-violet-700
                           text-white font-bold py-3 px-6 rounded-lg
                           transition-all duration-300 ease-in-out shadow-lg shadow-blue-600/20
                           focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <span class="i18n" data-key="addToken">Agregar Token</span>
                </button>
            </div>
        </form>

        <!-- Bot√≥n Volver -->
        <div class="mt-6 text-center">
            <a href="{{ url_for('view_exchange', exchange_id=exchange_id) }}"
               class="inline-block bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 px-6 rounded-lg
                      transition-colors duration-300 flex items-center justify-center space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                </svg>
                <span class="i18n" data-key="back">Volver</span>
            </a>
        </div>
    </div>

    <!-- Bot√≥n de Tutorial -->
    <div class="fixed bottom-4 right-4">
        <a href="https://chatgpt.com/g/g-67701000b5e88191afa7fbef8a1789fa-botxi-help"
           target="_blank"
           class="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold py-2 px-4 rounded-xl
                  shadow-lg shadow-blue-600/20 transition-all duration-300 ease-in-out transform hover:scale-105
                  flex items-center space-x-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
            </svg>
            <span class="i18n" data-key="tutorial">Tutorial</span>
        </a>
    </div>

    <!-- Scripts -->
    <script>
        // Traducciones
        const translations = {
            es: {
                addToken: "Agregar Token",
                symbol: "S√≠mbolo:",
                selectExchanges: "Seleccionar Exchanges:",
                strategy: "Estrategia:",
                dailyLossMax: "M√°ximo de P√©rdida Diaria (%):",
                reactivationThreshold: "Umbral de Reactivaci√≥n (%):",
                spread: "Spread (%):",
                takeProfit: "Take Profit (%):",
                tradeAmount: "Cantidad de Trade:",
                maxOrders: "N√∫mero M√°ximo de √ìrdenes Compra:",
                maxSellOrders: "N√∫mero M√°ximo de √ìrdenes de Venta:",
                orderExpiration: "Tiempo de Expiraci√≥n de √ìrdenes (minutos):",
                initialCapital: "Capital Inicial (USDT):",
                reinvestmentPercentage: "Porcentaje de Reinversi√≥n (%):",
                maxReinvestmentPct: "M√°ximo de Reinversi√≥n (%):",
                reservePercentage: "Porcentaje de Reserva (%):",
                totalBalanceUsdt: "Capital Total (USDT):",
                gridInterval: "Intervalo de Grilla:",
                minPrice: "Precio M√≠nimo:",
                checkInterval: "Intervalo de Revisi√≥n (s):",
                commission: "Comisi√≥n (%):",
                back: "Volver",
                tutorial: "Tutorial"
            },
            en: {
                addToken: "Add Token",
                symbol: "Symbol:",
                selectExchanges: "Select Exchanges:",
                strategy: "Strategy:",
                dailyLossMax: "Maximum Daily Loss (%):",
                reactivationThreshold: "Reactivation Threshold (%):",
                spread: "Spread (%):",
                takeProfit: "Take Profit (%):",
                tradeAmount: "Trade Amount:",
                maxOrders: "Maximum Number of Buy Orders:",
                maxSellOrders: "Maximum Number of Sell Orders:",
                orderExpiration: "Order Expiration Time (minutes):",
                initialCapital: "Initial Capital (USDT):",
                reinvestmentPercentage: "Reinvestment Percentage (%):",
                maxReinvestmentPct: "Maximum Reinvestment (%):",
                reservePercentage: "Reserve Percentage (%):",
                totalBalanceUsdt: "Total Capital (USDT):",
                gridInterval: "Grid Interval:",
                minPrice: "Minimum Price:",
                checkInterval: "Check Interval (s):",
                commission: "Commission (%):",
                back: "Back",
                tutorial: "Tutorial"
            },
            pt: {
                addToken: "Adicionar Token",
                symbol: "S√≠mbolo:",
                selectExchanges: "Selecionar Exchanges:",
                strategy: "Estrat√©gia:",
                dailyLossMax: "Perda Di√°ria M√°xima (%):",
                reactivationThreshold: "Limiar de Reativa√ß√£o (%):",
                spread: "Spread (%):",
                takeProfit: "Take Profit (%):",
                tradeAmount: "Quantidade de Trade:",
                maxOrders: "N√∫mero M√°ximo de Ordens de Compra:",
                maxSellOrders: "N√∫mero M√°ximo de Ordens de Venda:",
                orderExpiration: "Tempo de Expira√ß√£o das Ordens (minutos):",
                initialCapital: "Capital Inicial (USDT):",
                reinvestmentPercentage: "Porcentagem de Reinvestimento (%):",
                maxReinvestmentPct: "Reinvestimento M√°ximo (%):",
                reservePercentage: "Porcentagem de Reserva (%):",
                totalBalanceUsdt: "Capital Total (USDT):",
                gridInterval: "Intervalo da Grade:",
                minPrice: "Pre√ßo M√≠nimo:",
                checkInterval: "Intervalo de Verifica√ß√£o (s):",
                commission: "Comiss√£o (%):",
                back: "Voltar",
                tutorial: "Tutorial"
            }
        };

        // Nombres de temas por idioma
        const themeNames = {
            es: {
                dark: "Oscuro",
                light: "Claro",
                "blue-eye": "Azul"
            },
            en: {
                dark: "Dark",
                light: "Light",
                "blue-eye": "Blue Eye"
            },
            pt: {
                dark: "Escuro",
                light: "Claro",
                "blue-eye": "Azul"
            }
        };

        // Inicializar configuraci√≥n
        let currentLang = localStorage.getItem('botxi-language') || 'es';
        let currentTheme = localStorage.getItem('botxi-theme') || 'dark';

        // Funciones para manejar idiomas
        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('botxi-language', lang);
            document.documentElement.setAttribute('lang', lang);

            // Actualizar todos los elementos traducibles
            document.querySelectorAll('.i18n').forEach(el => {
                const key = el.getAttribute('data-key');
                if (key && translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });

            // Actualizar texto del bot√≥n de idioma
            const langButton = document.getElementById('language-button');
            const langEmoji = lang === 'es' ? 'üá™üá∏' : lang === 'en' ? 'üá∫üá∏' : 'üáßüá∑';
            const langName = lang === 'es' ? 'Espa√±ol' : lang === 'en' ? 'English' : 'Portugu√™s';
            langButton.querySelector('.language-text').textContent = `${langEmoji} ${langName}`;

            // Actualizar nombres de temas en el men√∫
            document.querySelectorAll('.theme-name').forEach(el => {
                const themeId = el.closest('.theme-option').getAttribute('data-theme');
                el.textContent = themeNames[lang][themeId];
            });

            // Actualizar texto del bot√≥n de tema
            const themeButton = document.getElementById('theme-button');
            const themeEmoji = currentTheme === 'dark' ? 'üåë' : currentTheme === 'light' ? '‚òÄÔ∏è' : 'üëÅÔ∏è';
            const themeName = themeNames[lang][currentTheme];
            themeButton.querySelector('.theme-text').textContent = `${themeEmoji} ${themeName}`;
        }

        function setTheme(theme) {
            currentTheme = theme;
            localStorage.setItem('botxi-theme', theme);

            const body = document.body;
            document.documentElement.className = theme;

            // Aplicar clases espec√≠ficas seg√∫n el tema
            if (theme === 'dark') {
                body.className = 'bg-slate-900 text-gray-100 font-sans min-h-screen transition-colors duration-300';
                document.querySelector('nav').className = 'sticky top-0 z-50 backdrop-blur-md bg-slate-900/80 border-b border-slate-800 shadow-md';
            } else if (theme === 'light') {
                body.className = 'bg-white text-slate-900 font-sans min-h-screen transition-colors duration-300';
                document.querySelector('nav').className = 'sticky top-0 z-50 backdrop-blur-md bg-white/80 border-b border-slate-300 shadow-md text-slate-900';
            } else if (theme === 'blue-eye') {
                body.className = 'bg-blueEye-900 text-blueEye-100 font-sans min-h-screen transition-colors duration-300';
                document.querySelector('nav').className = 'sticky top-0 z-50 backdrop-blur-md bg-blueEye-900/80 border-b border-blueEye-800 shadow-md';
            }

            // Actualizar texto del bot√≥n de tema
            const themeButton = document.getElementById('theme-button');
            const themeEmoji = theme === 'dark' ? 'üåë' : theme === 'light' ? '‚òÄÔ∏è' : 'üëÅÔ∏è';
            const themeName = themeNames[currentLang][theme];
            themeButton.querySelector('.theme-text').textContent = `${themeEmoji} ${themeName}`;
        }

        // Actualizar la interfaz seg√∫n la estrategia
        function updateFields() {
            const strategy = document.getElementById("strategy").value;
            const tradeAmountField = document.getElementById("trade_amount").parentElement;
            const tradeAmountInput = document.getElementById("trade_amount");
            const tradeAmountError = document.getElementById("tradeAmountError");
            const commonFields = document.getElementById("commonFields");
            const compoundFields = document.getElementById("compoundFields");
            const infinityFields = document.getElementById("infinityFields");

            // Ocultar todos los campos especiales
            commonFields.style.display = "none";
            compoundFields.style.display = "none";
            infinityFields.style.display = "none";

            // Deshabilitar todos los inputs
            document.querySelectorAll("input").forEach(input => {
                input.disabled = true;
                input.required = false;
            });

            // Habilitar campos comunes obligatorios
            document.getElementById("symbol").disabled = false;
            document.getElementById("symbol").required = true;
            document.getElementById("daily_loss_max").disabled = false;
            document.getElementById("daily_loss_max").required = true;
            document.getElementById("reactivation_threshold").disabled = false;
            document.getElementById("reactivation_threshold").required = true;

            if (strategy === "infinity") {
                infinityFields.style.display = "block";
                document.querySelectorAll("#infinityFields input").forEach(input => {
                    input.disabled = false;
                    input.required = true;
                });
                tradeAmountField.style.display = "none";
                tradeAmountInput.disabled = true;
                tradeAmountInput.required = false;
                tradeAmountError.style.display = "none";
            } else if (strategy === "compound") {
                commonFields.style.display = "block";
                compoundFields.style.display = "block";
                document.querySelectorAll("#commonFields input, #compoundFields input").forEach(input => {
                    input.disabled = false;
                    input.required = true;
                });
                tradeAmountField.style.display = "none";
                tradeAmountInput.disabled = true;
                tradeAmountInput.required = false;
                tradeAmountError.style.display = "none";
            } else {
                commonFields.style.display = "block";
                document.querySelectorAll("#commonFields input").forEach(input => {
                    input.disabled = false;
                    input.required = true;
                });
                tradeAmountField.style.display = "block";
                tradeAmountInput.disabled = false;
                tradeAmountInput.required = true;
                if (!tradeAmountInput.value) {
                    tradeAmountError.style.display = "block";
                }
            }
        }

        function updateDescriptions() {
            const strategy = document.getElementById("strategy").value;
            const descriptions = {
                strategy1: {
                    symbol: "Ejemplo: BTC/USDT. Grilla ML opera con un sistema de compras y ventas escalonadas.",
                    exchanges: "Selecciona en qu√© exchange(s) correr√° la Grilla ML.",
                    strategy: "Grilla ML: crea √≥rdenes de compra/venta en grilla y aprovecha rangos laterales.",
                    spread: "Porcentaje entre el precio de compra y venta en la grilla. Ej: 0.1 equivale a 10%.",
                    take_profit: "Porcentaje de ganancia para cerrar la venta. Ej: 0.05 => 5%.",
                    trade_amount: "Cantidad fija por trade. Ej: 0.002 BTC.",
                    max_orders: "M√°x √≥rdenes de compra simult√°neas. Ej: 5.",
                    max_sell_orders: "M√°x √≥rdenes de venta simult√°neas. Ej: 3.",
                    order_expiration: "Si la orden no se ejecuta antes del tiempo establecido, se cancela.",
                    daily_loss_max: "Porcentaje de ca√≠da diaria para pausar la estrategia. Ej: 10 => 10%.",
                    reactivation_threshold: "Si el mercado se recupera este %, el bot se reanuda. Ej: 5 => 5%."
                },
                compound: {
                    symbol: "Ejemplo: BNB/USDT. Compound reinvierte autom√°ticamente parte de las ganancias.",
                    exchanges: "Selecciona en qu√© exchange(s) ejecutar la estrategia Compound.",
                    strategy: "Compound: incrementa la posici√≥n con el % definido de ganancia, escalonando el capital.",
                    initial_capital: "Capital inicial asignado. Ej: 500 USDT.",
                    reinvestment_percentage: "Porcentaje de ganancia a reinvertir en cada ciclo. Ej: 75 => 75%.",
                    max_reinvestment_pct: "L√≠mite m√°ximo de reinversi√≥n acumulada. Ej: 50 => 50%.",
                    reserve_percentage: "Porcentaje que se mantiene como reserva y no se reinvierte. Ej: 20 => 20%.",
                    spread: "Diferencial entre precios de entrada/salida. Ej: 0.1 => 10%.",
                    take_profit: "Porcentaje de ganancia para vender. Ej: 5 => 5%.",
                    max_orders: "M√°x de compras simult√°neas en la grilla compound. Ej: 5.",
                    max_sell_orders: "M√°x de ventas simult√°neas que se pueden tener. Ej: 3.",
                    order_expiration: "Si la orden no se ejecuta antes del tiempo establecido, se cancela.",
                    daily_loss_max: "Detiene la estrategia si la p√©rdida diaria supera este %. Ej: 10 => 10%.",
                    reactivation_threshold: "Si el mercado se recupera este %, el bot se reanuda. Ej: 5 => 5%."
                },
                infinity: {
                    symbol: "Ejemplo: BNB/USDT. Infinity: estrategia de grilla continua automatizada.",
                    exchanges: "Selecciona el exchange en el que se ejecutar√° la estrategia Infinity.",
                    strategy: "Infinity: estrategia automatizada que ajusta la grilla de √≥rdenes bas√°ndose en el balance total y par√°metros de configuraci√≥n.",
                    total_balance_usdt: "Capital total asignado para Infinity. Ej: 1000 USDT.",
                    grid_interval: "Intervalo de grilla. Ej: 0.002 (0.2%).",
                    min_price: "Precio m√≠nimo para iniciar la grilla. Ej: 8000 USDT.",
                    check_interval: "Intervalo en segundos para revisar y ajustar la grilla. Ej: 5.",
                    commission: "Comisi√≥n por operaci√≥n. Ej: 0.001 (0.1%).",
                    daily_loss_max: "Detiene la estrategia si la p√©rdida diaria supera este %. Ej: 10 => 10%.",
                    reactivation_threshold: "Si el mercado se recupera este %, el bot se reanuda. Ej: 5 => 5%.",
                    reinvestment_percentage: "Reinversi√≥n de ganancias en Infinity. Ej: 75 => 75%.",
                    max_reinvestment_pct: "L√≠mite m√°ximo de reinversi√≥n acumulada en Infinity. Ej: 50 => 50%.",
                    reserve_percentage: "Porcentaje reservado de ganancias en Infinity. Ej: 20 => 20%."
                }
            };

            const selectedDesc = descriptions[strategy] || descriptions.strategy1;

            // Si la estrategia es infinity, usamos el prefijo "inf_" para los campos que est√°n en la secci√≥n infinity
            for (const [key, value] of Object.entries(selectedDesc)) {
                let elementId = "desc_" + key;
                if (strategy === "infinity" && ["total_balance_usdt", "grid_interval", "min_price", "check_interval", "commission", "reinvestment_percentage", "max_reinvestment_pct", "reserve_percentage"].includes(key)) {
                    elementId = "desc_inf_" + key;
                }
                const descElement = document.getElementById(elementId);
                if (descElement) {
                    descElement.innerText = value;
                }
            }
        }

        // Inicializar UI
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar idioma y tema
            setLanguage(currentLang);
            setTheme(currentTheme);

            // Inicializar campos del formulario
            updateFields();
            updateDescriptions();

            // Configurar eventos para el selector de idioma
            const langButton = document.getElementById('language-button');
            const langDropdown = document.getElementById('language-dropdown');

            langButton.addEventListener('click', function() {
                langDropdown.classList.toggle('hidden');
            });

            document.querySelectorAll('.language-option').forEach(option => {
                option.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    setLanguage(lang);
                    langDropdown.classList.add('hidden');
                });
            });

            // Configurar eventos para el selector de tema
            const themeButton = document.getElementById('theme-button');
            const themeDropdown = document.getElementById('theme-dropdown');

            themeButton.addEventListener('click', function() {
                themeDropdown.classList.toggle('hidden');
            });

            document.querySelectorAll('.theme-option').forEach(option => {
                option.addEventListener('click', function() {
                    const theme = this.getAttribute('data-theme');
                    setTheme(theme);
                    themeDropdown.classList.add('hidden');
                });
            });

            // Cerrar dropdowns al hacer clic fuera
            document.addEventListener('click', function(event) {
                if (!event.target.closest('#language-selector')) {
                    langDropdown.classList.add('hidden');
                }
                if (!event.target.closest('#theme-selector')) {
                    themeDropdown.classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html>